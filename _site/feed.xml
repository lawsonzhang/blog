<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Lawsonzhang's Homepage</title>
    <description>Lawson's blog,first step, second step...</description>
    <link>http://blog.lehehe.me//</link>
    <atom:link href="http://blog.lehehe.me//feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 26 Oct 2016 11:55:23 +0800</pubDate>
    <lastBuildDate>Wed, 26 Oct 2016 11:55:23 +0800</lastBuildDate>
    <generator>Jekyll v3.2.1</generator>
    
      <item>
        <title>秒杀、抢购活动设计</title>
        <description>&lt;h2 id=&quot;section&quot;&gt;&lt;strong&gt;秒杀阶段分析&lt;/strong&gt;&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;秒杀前：用户访问宝贝描述页，不断刷新，等待秒杀开始&lt;/li&gt;
    &lt;li&gt;秒杀中：用户点击秒杀按钮，洪水般的流量瞬间涌入系统，都想走在最前面，抢到宝贝&lt;/li&gt;
    &lt;li&gt;秒杀后：秒杀结束，商品已被抢完或者秒杀时间已过，用户访问秒杀结束页面，整个秒杀阶段结束&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section-1&quot;&gt;&lt;strong&gt;难度挑战&lt;/strong&gt;&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;秒杀前：大量用户频发刷新秒杀页面，都想第一个看到秒杀开始，越临近开始时间。刷新越频繁，这时候系统会承受巨大的读压力&lt;/li&gt;
    &lt;li&gt;秒杀中：用户的秒杀请求短时间内持续涌入，前端访问量暴增，并且会牵扯到写库的需求，还有在对于单一热点商品库存判断和递减，由于写库是排他操作，一个一个排队处理，数据库写压力很大。&lt;/li&gt;
    &lt;li&gt;秒杀后：和秒杀前类似，短时间内单页很多用户访问，但时间一过，页面就没有访问量了&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section-2&quot;&gt;&lt;strong&gt;解决方案&lt;/strong&gt;&lt;/h2&gt;
&lt;h3 id=&quot;section-3&quot;&gt;&lt;strong&gt;服务器分制思想&lt;/strong&gt;&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;LVS、&lt;a href=&quot;http://blog.lehehe.me/blog/&quot;&gt;Nginx反向代理&lt;/a&gt;等增强服务器的抗压能力&lt;/li&gt;
    &lt;li&gt;增加服务器的带宽&lt;/li&gt;
    &lt;li&gt;数据库读写分离、&lt;a href=&quot;http://blog.lehehe.me/blog/&quot;&gt;主从复制&lt;/a&gt;增强数据库的读写能力&lt;/li&gt;
    &lt;li&gt;适当增加数据库最大连接数&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section-4&quot;&gt;&lt;strong&gt;库存管理&lt;/strong&gt;&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;抢购秒杀最容易出现的库存管理问题，例如超卖等&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;[1]: MySQL数据库(基于事务(transcation)的原子性)&lt;/strong&gt;&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;悲观锁
      &lt;blockquote&gt;

        &lt;ol&gt;
          &lt;li&gt;
            &lt;p&gt;利用MySQL innodb引擎的写独占锁&lt;/p&gt;
          &lt;/li&gt;
          &lt;li&gt;
            &lt;p&gt;&lt;strong&gt;SELECT&lt;/strong&gt; * FROM table_name &lt;strong&gt;FOR UPDATE&lt;/strong&gt;;    UPDATE table_name SET field_name = field_value - 1;&lt;/p&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/blockquote&gt;
    &lt;/li&gt;
    &lt;li&gt;乐观锁
      &lt;blockquote&gt;

        &lt;ol&gt;
          &lt;li&gt;
            &lt;p&gt;乐观的认为我每一次更新库存都不会因为并发而产生多扣库存，当一旦发现多扣产生，就执行数据回滚&lt;/p&gt;
          &lt;/li&gt;
          &lt;li&gt;
            &lt;p&gt;先执行UPDATE库存操作，发现库存小于0就执行回滚(&lt;strong&gt;rollback&lt;/strong&gt;)&lt;/p&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/blockquote&gt;
    &lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;&lt;strong&gt;[2]: NOSQL(Redis)&lt;/strong&gt;&lt;/p&gt;
  &lt;blockquote&gt;

    &lt;p&gt;Redis支持list类型存储，使用push、pop入列和出列，抢购库存大可分多条队列并行&lt;/p&gt;

    &lt;p&gt;进入队列后的用户可以排队下单，进入等待秒杀页面，未进入队列直接跳转活动结束页面&lt;/p&gt;

    &lt;p&gt;用PHP书写守护进程，while无限循环pop队列数据，执行下单操作&lt;/p&gt;

    &lt;p&gt;也可以用其他MQ实现消息队列功能&lt;/p&gt;

    &lt;p&gt;这里还有一种以Redis为主，舍弃关系型数据库参与秒杀的方式&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;ul&gt;
        &lt;li&gt;活动开始前先将秒杀的参与库存从总库存中去除，并加入Redis库存之中&lt;/li&gt;
        &lt;li&gt;使用Redis的get和set操作Redis中的库存(Redis也支持transaction)&lt;/li&gt;
        &lt;li&gt;秒杀活动下单执行另外一套扣除Redis库存逻辑&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/blockquote&gt;

    &lt;p&gt;&lt;strong&gt;[3]: 前端层面&lt;/strong&gt;&lt;/p&gt;
  &lt;/blockquote&gt;

  &lt;ul&gt;
    &lt;li&gt;用户在秒杀前访问的页面使用静态化处理，资源全部挂载在CDN&lt;/li&gt;
    &lt;li&gt;使用动态加载JS方式判断秒杀开始: 去CDN请求一个JS，该JS用于秒杀开始后跳转秒杀页面使用，必须在秒杀开始之后生成，同理：秒杀页面也应该在活动开始之后生成&lt;/li&gt;
  &lt;/ul&gt;

&lt;/blockquote&gt;

&lt;h3 id=&quot;section-5&quot;&gt;&lt;strong&gt;秒杀开始标志&lt;/strong&gt;&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;ul&gt;
    &lt;li&gt;服务器端统一在时间到之后，将某个开始标记打开(redis字段等)&lt;/li&gt;
    &lt;li&gt;各节点不停请求服务器标记是否打开&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Wed, 26 Oct 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//php/2016/10/26/%E7%A7%92%E6%9D%80-%E6%8A%A2%E8%B4%AD%E6%B4%BB%E5%8A%A8%E8%AE%BE%E8%AE%A1.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//php/2016/10/26/%E7%A7%92%E6%9D%80-%E6%8A%A2%E8%B4%AD%E6%B4%BB%E5%8A%A8%E8%AE%BE%E8%AE%A1.html</guid>
        
        <category>php</category>
        
        
        <category>PHP</category>
        
      </item>
    
      <item>
        <title>ShopNC消息队列实现</title>
        <description>&lt;h2 id=&quot;shopncredislist&quot;&gt;ShopNC的消息队列使用的是Redis的list实现。&lt;/h2&gt;

&lt;h3 id=&quot;section&quot;&gt;以下单成功给商家消息推送为例，下单成功后执行：&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// 发送商家提醒
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'new_order'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$orderInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'param'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;'order_sn'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$orderInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'order_sn'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;QueueClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'sendStoreMsg'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;    
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;queueclient-sendstoremsgkey&quot;&gt;QueueClient代码如下 主要执行入列逻辑，’sendStoreMsg’是所有推送店铺消息共用key，如果消息队列未开启，就直接去执行发送信息逻辑方法&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;QueueClient&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$queuedb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;sd&quot;&gt;/**
     * 入列
     * @param string $key
     * @param array $value
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'queue.open'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;Logic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'queue'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;is_object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$queuedb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$queuedb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;QueueDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$queuedb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;serialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;cron-crontabindexphpactqueuecrontabqueuephpindexop-&quot;&gt;再说出列： cron脚本定时执行 /crontab/index.php?act=queue，这会执行crontab文件夹下的queue.php里的indexOp方法， 这个方法里的代码主要执行消息队列的出列操作&lt;/h3&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$logicQueue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Logic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'queue'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 实例化/data/logic/queue.php中的 queueLogic类
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$worker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;QueueServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 实例化 /core/framework/libraries/queue.php中的QueueServer类
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$queues&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$worker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 扫描list中所有内容
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$worker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$queues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 取出队列中所有内容
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;is_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 取出列中的键值 当时以方法名存储
&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$arg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 取出内容 反序列化
&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$logicQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// 执行queueLogic中的选定方法
&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'state'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'msg'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;checkActive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;unset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;    
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;queueserverqueuedb&quot;&gt;QueueServer类主要去调用QueueDB中的方法&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;QueueServer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_queuedb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_queuedb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;QueueDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;sd&quot;&gt;/**
     * 取出队列
     * @param unknown $key
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;unserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_queuedb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_queuedb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;queuedb-lpush-brpop&quot;&gt;QueueDB代码如下 lpush入列 brpop出列&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;QueueDB&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//定义对象
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//存储前缀
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_tb_prefix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'QUEUE_TABLE_'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//存定义存储表的数量,系统会随机分配存储
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_tb_num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//临时存储表
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_tb_tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'TMP_TABLE'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;sd&quot;&gt;/**
     * 初始化
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;extension_loaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'redis'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;throw_exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'redis failed to load'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_redis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'queue.host'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'queue.port'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;sd&quot;&gt;/**
     * 入列
     * @param unknown $value
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;lPush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_tb_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_tb_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
             &lt;span class=&quot;nx&quot;&gt;throw_exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;sd&quot;&gt;/**
     * 取得所有的list key(表)
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$list_key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_tb_num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$list_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_tb_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$list_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;sd&quot;&gt;/**
     * 出列
     * @param unknown $key
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;brPop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;sd&quot;&gt;/**
     * 清空,暂时无用
     */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;flushAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;key&quot;&gt;在执行消息中key执行方法&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * 发送店铺消息
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sendStoreMsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sendStoreMsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'new_order'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pandaeeWorkerMobile'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           	&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
               &lt;span class=&quot;s1&quot;&gt;'13003297107'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//李晨艳
&lt;/span&gt;               &lt;span class=&quot;s1&quot;&gt;'15370777530'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//杨蓓
&lt;/span&gt;               &lt;span class=&quot;s1&quot;&gt;'15121192885'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//张敏
&lt;/span&gt;               &lt;span class=&quot;s1&quot;&gt;'15618297863'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//阿飞
&lt;/span&gt;           	&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'param'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// 新订单产生推送至商家
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'code'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'new_order'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pushToApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;sendstoremsg&quot;&gt;会实例化一个sendStoreMsg类&lt;/h3&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;sd&quot;&gt;/**
 * 商家有新订单的推送
 */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;pushToApp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$storeId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$storeInfo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'store'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getStoreInfoByID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$storeId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$sellerMemberId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$storeInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'member_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pushOrderToSeller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sellerMemberId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 24 Oct 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//php/2016/10/24/ShopNC%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//php/2016/10/24/ShopNC%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0.html</guid>
        
        <category>php</category>
        
        
        <category>PHP</category>
        
      </item>
    
      <item>
        <title>PHP冒泡</title>
        <description>&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	$arr = [201, 3, -123, 261, 78, 35, 799, 1024, 1112, 235, 136, 138, 249, 1245, -25, 7, 889, 9951, 78, -1, 85, 0, 783, 2014, 93.2, -3.2];

	/**
	 * 冒泡排序
	 *
	 * 循环使用相邻两个元素的值进行比较
	 * 需要中间变量 用于调换位置 大的往后，小的往前
	 */
	function maopao($arr)
	{
		(string) $tem = '';
		for ($i=0; $i &lt;span class=&quot;nt&quot;&gt;&amp;lt; count&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;($&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt; 
			&lt;span class=&quot;na&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;($&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;j=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;0;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;($&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;-1-&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt; 
				&lt;span class=&quot;na&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;($&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;[$&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; $arr[$j+1]) {
					$tem = $arr[$j];
					$arr[$j] = $arr[$j+1];
					$arr[$j+1] = $tem;
				}
			}
		}
		return $arr;
	}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 13 Oct 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//php/2016/10/13/php%E5%86%92%E6%B3%A1.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//php/2016/10/13/php%E5%86%92%E6%B3%A1.html</guid>
        
        
        <category>PHP</category>
        
      </item>
    
      <item>
        <title>技能树</title>
        <description>&lt;h2 id=&quot;php&quot;&gt;PHP&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;框架&lt;/li&gt;
  &lt;li&gt;调试&lt;/li&gt;
  &lt;li&gt;web安全&lt;/li&gt;
  &lt;li&gt;设计模式&lt;/li&gt;
  &lt;li&gt;php-cgi php-fpm&lt;/li&gt;
  &lt;li&gt;扩展&lt;/li&gt;
  &lt;li&gt;性能优化&lt;/li&gt;
  &lt;li&gt;内部实现(life cycle)&lt;/li&gt;
  &lt;li&gt;单元测试&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;mysql&quot;&gt;mysql&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;普通语句&lt;/li&gt;
  &lt;li&gt;复杂语句&lt;/li&gt;
  &lt;li&gt;内置函数和运算&lt;/li&gt;
  &lt;li&gt;存储过程和视图&lt;/li&gt;
  &lt;li&gt;优化
    &lt;ol&gt;
      &lt;li&gt;表结构优化&lt;/li&gt;
      &lt;li&gt;存储引擎&lt;/li&gt;
      &lt;li&gt;sql优化&lt;/li&gt;
      &lt;li&gt;索引优化&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;复制(replication)&lt;/li&gt;
  &lt;li&gt;mysql管理、权限、日志&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;nosql&quot;&gt;nosql&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;redis&lt;/li&gt;
  &lt;li&gt;memcached&lt;/li&gt;
  &lt;li&gt;mongodb&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;网络与架构&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;负载均衡&lt;/li&gt;
  &lt;li&gt;反向代理&lt;/li&gt;
  &lt;li&gt;消息系统&lt;/li&gt;
  &lt;li&gt;分布式存储&lt;/li&gt;
  &lt;li&gt;分布式计算&lt;/li&gt;
  &lt;li&gt;cdn&lt;/li&gt;
  &lt;li&gt;plp&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;linux&quot;&gt;linux&lt;/h2&gt;
</description>
        <pubDate>Tue, 27 Sep 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//php/2016/09/27/php-skilltree.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//php/2016/09/27/php-skilltree.html</guid>
        
        <category>php</category>
        
        
        <category>PHP</category>
        
      </item>
    
      <item>
        <title>php &amp;=</title>
        <description>&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
引用是什么
在 PHP 中引用意味着用不同的名字访问同一个变量内容。这并不像 C 的指针，它们是符号表别名。注意在 PHP 中，变量名和变量内容是不一样的，因此同样的内容可以有不同的名字。最接近的比喻是 Unix 的文件名和文件本身 － 变量名是目录条目，而变量内容则是文件本身。引用可以被看作是 Unix 文件系统中的紧密连接。 

引用做什么
PHP 的引用允许你用两个变量来指向同一个内容。意思是，当你这样做时： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; =&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt;
?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

这意味着 &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; 和 &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 指向了同一个变量。 
注&lt;/span&gt;: &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; 和 &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt; 在这里是完全相同的，这并不是 &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; 指向了 &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt; 或者相反，而是 &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; 和 &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 指向了同一个地方。 

同样的语法可以用在函数中，它返回引用，以及用在 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; 运算符中（PHP 4.0.4&lt;span style=&quot;color: #000000;&quot;&gt; 以及以后版本）： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt; =&amp;amp; &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; fooclass();
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$foo&lt;/span&gt; =&amp;amp; find_var (&lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

注&lt;/span&gt;: 不用 &amp;amp; 运算符导致对象生成了一个拷贝。如果你在类中用 &lt;span style=&quot;color: #800080;&quot;&gt;$this&lt;/span&gt;，它将作用于该类当前的实例。没有用 &amp;amp; 的赋值将拷贝这个实例（例如对象）并且 &lt;span style=&quot;color: #800080;&quot;&gt;$this&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 将作用于这个拷贝上，这并不总是想要的结果。由于性能和内存消耗的问题，通常你只想工作在一个实例上面。 

尽管你可以用 @ 运算符来关闭构造函数中的任何错误信息，例如用 @&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;，但用 &amp;amp;&lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 语句时这不起效果。这是 Zend 引擎的一个限制并且会导致一个解析错误。 

引用做的第二件事是用引用传递变量。这是通过在函数内建立一个本地变量并且该变量在呼叫范围内引用了同一个内容来实现的。例如： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; foo (&amp;amp;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
{
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;++&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;=5&lt;span style=&quot;color: #000000;&quot;&gt;;
foo (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

将使 &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; 变成 6。这是因为在 foo 函数中变量 &lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt; 指向了和 &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 指向的同一个内容。更多详细解释见引用传递。 

引用做的第三件事是引用返回。 

引用不是什么
如前所述，引用不是指针。这意味着下面的结构不会产生你预期的效果： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; foo (&amp;amp;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
{
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt; =&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$GLOBALS&lt;/span&gt;[&quot;baz&quot;&lt;span style=&quot;color: #000000;&quot;&gt;];
}
foo(&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

这将使 foo 函数中的 &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt; 变量在函数调用时和 &lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt; 绑定在一起，但接着又被重新绑定到了 &lt;span style=&quot;color: #800080;&quot;&gt;$GLOBALS&lt;/span&gt;[&quot;baz&quot;] 上面。不可能通过引用机制将 &lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt; 在函数调用范围内绑定到别的变量上面，因为在函数 foo 中并没有变量 &lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt;（它被表示为 &lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;，但是 &lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 只有变量内容而没有调用符号表中的名字到值的绑定）。 

引用传递
你可以将一个变量通过引用传递给函数，这样该函数就可以修改其参数的值。语法如下： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; foo (&amp;amp;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
{
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;++&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;=5&lt;span style=&quot;color: #000000;&quot;&gt;;
foo (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; $a is 6 here&lt;/span&gt;
?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

注意在函数调用时没有引用符号 － 只有函数定义中有。光是函数定义就足够使参数通过引用来正确传递了。 

以下内容可以通过引用传递： 

变量，例如 foo(&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) 

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;New&lt;/span&gt; 语句，例如 foo(&lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; foobar()) 

从函数中返回的引用，例如： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; &amp;amp;&lt;span style=&quot;color: #000000;&quot;&gt;bar()
{
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; = 5&lt;span style=&quot;color: #000000;&quot;&gt;;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}
foo(bar());
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

详细解释见引用返回。 

任何其它表达式都不能通过引用传递，结果未定义。例如下面引用传递的例子是无效的： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; bar() &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; Note the missing &amp;amp;&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;{
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; = 5&lt;span style=&quot;color: #000000;&quot;&gt;;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}
foo(bar());

foo(&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; = 5) &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 表达式，不是变量&lt;/span&gt;
foo(5) &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 常量，不是变量&lt;/span&gt;
?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

这些条件是 PHP &lt;/span&gt;4.0.4&lt;span style=&quot;color: #000000;&quot;&gt; 以及以后版本有的。 

引用返回
引用返回用在当你想用函数找到引用应该被绑定在哪一个变量上面时。当返回引用时，使用此语法： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;function&lt;/span&gt; &amp;amp;find_var (&lt;span style=&quot;color: #800080;&quot;&gt;$param&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
{
    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;/*&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; ...code... &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;*/&lt;/span&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$found_var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}

&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$foo&lt;/span&gt; =&amp;amp; find_var (&lt;span style=&quot;color: #800080;&quot;&gt;$bar&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$foo&lt;/span&gt;-&amp;gt;x = 2&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

本例中 find_var 函数所返回的对象的属性将被设定（译者：指的是 &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$foo&lt;/span&gt;-&amp;gt;x = 2&lt;span style=&quot;color: #000000;&quot;&gt;; 语句），而不是拷贝，就和没有用引用语法一样。 

注&lt;/span&gt;: 和参数传递不同，这里必须在两个地方都用 &amp;amp; 符号 － 来指出返回的是一个引用，而不是通常的一个拷贝，同样也指出 &lt;span style=&quot;color: #800080;&quot;&gt;$foo&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 是作为引用的绑定，而不是通常的赋值。 

取消引用
当你 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;unset&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 一个引用，只是断开了变量名和变量内容之间的绑定。这并不意味着变量内容被销毁了。例如： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt; = 1&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt; =&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;unset&lt;/span&gt; (&lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

不会 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;unset&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$b&lt;/span&gt;，只是 &lt;span style=&quot;color: #800080;&quot;&gt;$a&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;。 

再拿这个和 Unix 的 &lt;/span&gt;&lt;span style=&quot;color: #008080;&quot;&gt;unlink&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 调用来类比一下可能有助于理解。 

引用定位
许多 PHP 的语法结构是通过引用机制实现的，所以上述有关引用绑定的一切也都适用于这些结构。一些结构，例如引用传递和返回，已经在上面提到了。其它使用引用的结构有： 

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;global&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 引用
当用 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;global&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 声明一个变量时实际上建立了一个到全局变量的引用。也就是说和这样做是相同的： 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt; =&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$GLOBALS&lt;/span&gt;[&quot;var&quot;&lt;span style=&quot;color: #000000;&quot;&gt;];
&lt;/span&gt;?&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;  

这意味着，例如，&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;unset&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$var&lt;/span&gt; 不会 &lt;span style=&quot;color: #0000ff;&quot;&gt;unset&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 全局变量。 

&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$this&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
在一个对象的方法中，&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$this&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; 永远是调用它的对象的引用。 

&lt;/span&gt;&amp;lt;?&lt;span style=&quot;color: #000000;&quot;&gt;php
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;/*&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;*
 * (C) CopyRight 2008 MagicToolBox - www.magictoolbox.com - support@magictoolbox.com
*&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;*/&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;require_once&lt;/span&gt;(DIR_FS_CATALOG . DIR_WS_MODULES . 'magictoolbox/magictoolbox_addons.php'&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt; = magictoolboxLoadModule('MagicZoomPlus'&lt;span style=&quot;color: #000000;&quot;&gt;);
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$enabled&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;isset&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['main_page']) ? &lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['main_page'] : &lt;span style=&quot;color: #800080;&quot;&gt;$_GET&lt;/span&gt;['main_page'&lt;span style=&quot;color: #000000;&quot;&gt;];
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$cPath&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;isset&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['cPath']) ? &lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['cPath'] : &lt;span style=&quot;color: #800080;&quot;&gt;$_GET&lt;/span&gt;['cPath'&lt;span style=&quot;color: #000000;&quot;&gt;];
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$products_id&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;isset&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['products_id']) ? &lt;span style=&quot;color: #800080;&quot;&gt;$_REQUEST&lt;/span&gt;['products_id'] : &lt;span style=&quot;color: #800080;&quot;&gt;$_GET&lt;/span&gt;['products_id'&lt;span style=&quot;color: #000000;&quot;&gt;];

&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;type == 'standard' &amp;amp;&amp;amp; !&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('template', 'original') &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('magicscroll', 'yes'&lt;span style=&quot;color: #000000;&quot;&gt;)) {
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt; = magictoolboxLoadModule('magicscroll'&lt;span style=&quot;color: #000000;&quot;&gt;);
　　&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt;-&amp;gt;params-&amp;gt;appendArray(&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;&lt;span style=&quot;color: #000000;&quot;&gt;getArray());
&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt;-&amp;gt;params-&amp;gt;set('direction', &lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('template', &lt;span style=&quot;color: #0000ff;&quot;&gt;array&lt;/span&gt;('left', 'right')) ? 'bottom' : 'right'&lt;span style=&quot;color: #000000;&quot;&gt;);
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(ZEN_MAGICZOOMPLUS_STATUS == 'true'&lt;span style=&quot;color: #000000;&quot;&gt;) {

    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt; =  !&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-whats-new-block', 'No') ||
                        !&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-specials-block', 'No') ||
                        !&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-featured-block', 'No'&lt;span style=&quot;color: #000000;&quot;&gt;);

    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;type == 'standard'&lt;span style=&quot;color: #000000;&quot;&gt;) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;( (&lt;span style=&quot;color: #008080;&quot;&gt;intval&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$cPath&lt;/span&gt;) &amp;gt; 0 &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-category-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;)) || &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; category page&lt;/span&gt;
            (&lt;span style=&quot;color: #008080;&quot;&gt;intval&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$products_id&lt;/span&gt;) &amp;gt; 0 &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-product-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;)) || &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; product page&lt;/span&gt;
            (&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'products_new' &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-products-new-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;)) ||&lt;span style=&quot;color: #000000;&quot;&gt;
            (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'products_all' &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-products-all-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;)) ||&lt;span style=&quot;color: #000000;&quot;&gt;
            (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'advanced_search_result' &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-products-search-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;))
        ) {
            &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$enabled&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
        }
    } &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;elseif&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;type == 'category' || &lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;type == 'circle'&lt;span style=&quot;color: #000000;&quot;&gt;) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;( (&lt;span style=&quot;color: #008080;&quot;&gt;intval&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$products_id&lt;/span&gt;) &amp;gt; 0 &amp;amp;&amp;amp; (!&lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;params-&amp;gt;checkValue('use-effect-on-product-page', 'No') || &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;)) || &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; product page&lt;/span&gt;
            (&lt;span style=&quot;color: #008080;&quot;&gt;intval&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$cPath&lt;/span&gt;) &amp;gt; 0 &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;) || &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; category page&lt;/span&gt;
            (&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'products_new' &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;) ||&lt;span style=&quot;color: #000000;&quot;&gt;
            (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'products_all' &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;) ||&lt;span style=&quot;color: #000000;&quot;&gt;
            (&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$main_page&lt;/span&gt; == 'advanced_search_result' &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$enable_on_block&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
        ) {
            &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$enabled&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
        }
    }
}

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (!&lt;span style=&quot;color: #800080;&quot;&gt;$GLOBALS&lt;/span&gt;[&quot;MAGICZOOMPLUS_HEADERS_LOADED&quot;] &amp;amp;&amp;amp; &lt;span style=&quot;color: #800080;&quot;&gt;$enabled&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$mod&lt;/span&gt;-&amp;gt;headers(DIR_WS_CATALOG . DIR_WS_TEMPLATE . 'jscript', DIR_WS_CATALOG . DIR_WS_TEMPLATE . 'css'&lt;span style=&quot;color: #000000;&quot;&gt;);
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(&lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) {
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;echo&lt;/span&gt; &lt;span style=&quot;color: #800080;&quot;&gt;$scroll&lt;/span&gt;-&amp;gt;headers(DIR_WS_CATALOG . DIR_WS_TEMPLATE . 'jscript', DIR_WS_CATALOG . DIR_WS_TEMPLATE . 'css'&lt;span style=&quot;color: #000000;&quot;&gt;);
    }
    &lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;$GLOBALS&lt;/span&gt;[&quot;MAGICZOOMPLUS_HEADERS_LOADED&quot;] = &lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
}&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;```&lt;/p&gt;
</description>
        <pubDate>Mon, 26 Sep 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//php/2016/09/26/php-=&.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//php/2016/09/26/php-=&.html</guid>
        
        <category>php</category>
        
        
        <category>PHP</category>
        
      </item>
    
      <item>
        <title>First Blog</title>
        <description>&lt;h1 id=&quot;my-first-blog&quot;&gt;My First Blog&lt;/h1&gt;
</description>
        <pubDate>Mon, 26 Sep 2016 00:00:00 +0800</pubDate>
        <link>http://blog.lehehe.me//life/2016/09/26/first-blog.html</link>
        <guid isPermaLink="true">http://blog.lehehe.me//life/2016/09/26/first-blog.html</guid>
        
        
        <category>Life</category>
        
      </item>
    
  </channel>
</rss>
