<!DOCTYPE html>
<html>

	
	    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <meta content="thinkPHP 5.0.9 简要分析" name="description">
  
  
    <meta name="keywords" content="php，thinkphp">
  
  <meta name="author" content="Lawsonzhang">

  <title>
    
        Lawsonzhang's Homepage|thinkPHP 5.0.9 简要分析
    
  </title>
  <!-- favicon -->
  <link rel="shortcut icon" href="/static/img/favicon.ico">

  <!-- Third-party CSS -->
  <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/bower_components/animate.css/animate.min.css" rel="stylesheet">
  <link href="/bower_components/components-font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="/static/font-mfizz/font-mfizz.css" rel="stylesheet">
  <link href="/bower_components/toastr/toastr.min.css" rel="stylesheet">
  <link href="/bower_components/jquery.gritter/css/jquery.gritter.css" rel="stylesheet">
  <link rel="stylesheet" href="/search/css/cb-search.css">

  <!-- Custom styles for this template -->
  <link href="/static/css/style.min.css" rel="stylesheet">
  <link href="/static/css/pygments.css" rel="stylesheet">

  <!-- Scripts -->
  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/search/js/bootstrap3-typeahead.min.js"></script>

  <!-- cb-search -->
  <script src="/search/js/cb-search.js"></script>
  <script>
    $(function(){
        $("pre").css('display','block');
    });
  </script>
  <!-- Mainly scripts -->
  <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/bower_components/metisMenu/dist/metisMenu.min.js"></script>
  <script src="/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>

  <!-- Peity -->
  <script src="/bower_components/peity/jquery.peity.min.js"></script>

  <script src="/bower_components/PACE/pace.min.js"></script>
  <script src="/bower_components/wow/dist/wow.min.js"></script>
  <!-- Custom and plugin javascript -->
  <script src="/static/js/inspinia.js"></script>

  <!-- Rickshaw -->
  <script src="/bower_components/rickshaw/vendor/d3.v3.js"></script>
  <script src="/bower_components/rickshaw/rickshaw.min.js"></script>


  <!-- jPages -->
  <script src="/static/js/jPages.js"></script>
  <script src="/static/js/js.js"></script>
  <script id="dsq-count-scr" src="//jalpc.disqus.com/count.js" async></script>
  <script type="text/javascript">
        $(function(){
          /* initiate the plugin */
          $("div.pag-holder").jPages({
              containerID  : "pag-itemContainer",
              perPage      : 5,  /* num of items per page */
              startPage    : 1,
              startRange   : 1,
              midRange     : 3,
              endRange     : 1
          });
      });
  </script>
</head>

	


<body id="page-top" class="landing-page">

	
	    <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
      opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px"
           placeholder="Search Blog"
           >

    <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;">
        <img src="/search/img/cb-close.png"  id="close-btn"/>
    </div>
</div>

<div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;">
    <img src="/search/img/cb-search.png"  id="search-btn"  title="Double click Ctrl"/>
</div>

<div class="navbar-wrapper">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">Lawsonzhang's Homepage</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a class="page-scroll" href="/blog/"></a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/blog/">Blog</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/php/">PHP</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/linux/">Linux</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/javascript/">Javascript</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/mysql/">MySQL</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/nosql/">NoSQL</a></li>
                        
                            
                            <li>
                            
                            <a class="page-scroll" href="/life/">Life</a></li>
                        
                    </ul>
                </div>
            </div>
        </nav>
</div>
<div id="inSlider" class="carousel carousel-fade" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#inSlider" data-slide-to="0" class="active"></li>
        <li data-target="#inSlider" data-slide-to="1"></li>
    </ol>
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <div class="container">
                <div class="carousel-caption">
                </div>
                <div class="carousel-image wow zoomIn">
                    <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> -->
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back one"></div>

        </div>
        <div class="item">
            <div class="container">
                <div class="carousel-caption blank">
                </div>
            </div>
            <!-- Set background for slide in css -->
            <div class="header-back two"></div>
        </div>
    </div>
    <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#inSlider" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

	

    <div class="wrapper wrapper-content  animated fadeInRight article">
    <div class="row">
        <div class="col-lg-10 col-lg-offset-1">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="pull-right">
                    	
                        	<button class="btn btn-white btn-xs" type="button">PHP</button>
                        
                    </div>
                    <div class="text-center article-title">
                    <span class="text-muted"><i class="fa fa-clock-o"></i> 23 May 2017</span>
                        <h1>
                            thinkPHP 5.0.9 简要分析
                        </h1>
                    </div>
                    	<h1 id="thinkphp-509-">thinkPHP 5.0.9 简要分析</h1>

<hr />

<h3 id="section">一、路由</h3>

<ol>
  <li>
    <h4 id="section-1">支持自定义路由，但是不强制路由</h4>
  </li>
</ol>

<blockquote>
  <p>默认模式：PATHINFO模式 可以通过config设置路由支持</p>
</blockquote>

<ol>
  <li>
    <h4 id="section-2">支持路由注册缓存</h4>
  </li>
</ol>

<blockquote>
  <p>会在runtime目录下面生成一个route.php路由缓存文件</p>
</blockquote>

<ol>
  <li>
    <h4 id="section-3">路由注册形式</h4>
  </li>
</ol>

<blockquote>
  <p>静态和动态注册
支持形式包括但不限于: Closure、group、全局/局部变量规则限定、REST resource路由、301重定向、namespace路由、MISS路由、alias、模型绑定、泛域名绑定
https识别
行为监测 监测匹配前是否满足条件 或者 路由匹配成功后执行后续动作
针对单条路由 缓存结果   <code class="highlighter-rouge">Route::get('new/:name$','News/read',['cache'=&gt;3600]);</code></p>
</blockquote>

<h3 id="section-4">二、日志</h3>

<ol>
  <li>
    <h4 id="file">支持自定义扩展日志驱动，默认是FILE</h4>
  </li>
  <li>
    <h4 id="section-5">日志先记录在内存中，请求结束后执行驱动写入</h4>
  </li>
  <li>
    <h4 id="logerrornoticeinfodebugsql">日志级别包括：log\error\notice\info\debug\sql</h4>
  </li>
  <li>
    <h4 id="section-6">日志记录级别可在配置中写入 也可以在每次写入时自定义</h4>
  </li>
  <li>
    <h4 id="tracelog">辅助函数 trace可在不使用Log类直接写入日志</h4>
  </li>
  <li>
    <h4 id="section-7">可以按日志级别做分别保存</h4>
  </li>
  <li>
    <h4 id="section-8">可以对服务器日志写入管理授权 控制高负载服务器的写入</h4>
  </li>
</ol>

<h3 id="rpc">三、RPC通信</h3>

<h4 id="venderworkman">vender里面集成了workman库</h4>
<h4 id="workmansocket">可以通过workman进行socket进行远程（同步/异步）调用</h4>

<h3 id="section-9">四、数据库</h3>

<ol>
  <li>
    <h4 id="pdo">支持PDO连接</h4>
  </li>
  <li>
    <h4 id="dbquerysql-dbexcutesql-sprintf">Db::query执行原生查询SQL语句 Db::excute执行原生写入SQL语句 类sprintf语法</h4>
  </li>
  <li>
    <h4 id="dbconnectconfig-">Db::connect($config) 连接指定配置数据库</h4>
  </li>
  <li>
    <h4 id="dbdbdbuser-whereid1-find">辅助函数db可以代替Db类<code class="highlighter-rouge">db('user')-&gt;where('id',1)-&gt;find();</code></h4>
  </li>
  <li>
    <h4 id="section-10">支持闭包传参查询</h4>

    <blockquote>
      <div class="highlighter-rouge"><pre class="highlight"><code> Db::select(function($query){
   $query-&gt;table('think_user')-&gt;where('status',1);
 });
</code></pre>
      </div>
    </blockquote>
  </li>
  <li>
    <h4 id="chunk">支持对数据集闭包处理 chunk</h4>
  </li>
  <li>
    <h4 id="json-">支持json字段 数据查询</h4>

    <blockquote>
      <p>// 查询JSON类型字段 （info字段为json类型）
<code class="highlighter-rouge">Db::table('think_user')-&gt;where('info$.email','thinkphp@qq.com')-&gt;find();</code></p>
    </blockquote>
  </li>
  <li>
    <h4 id="section-11">支持延时更新数据库 <code class="highlighter-rouge">待看源码</code></h4>
  </li>
  <li>
    <h4 id="section-12">支持链式操作</h4>
  </li>
  <li>
    <h4 id="count--max-">支持聚合查询 count  max 等</h4>
  </li>
  <li>
    <h4 id="where---wherenull-wherein">支持多种快捷where方法  例如 whereNull whereIn等</h4>
  </li>
  <li>
    <h4 id="section-13">支持闭包进行子查询</h4>
  </li>
  <li>
    <h4 id="beforeselectafterinsert">支持各种查询事件绑定 before_select、after_insert等</h4>

    <div class="highlighter-rouge"><pre class="highlight"><code> Query::event('after_insert','callback');
 Query::event('before_select',function($options,$query){
    // 事件处理
    return $result;
 });
</code></pre>
    </div>
  </li>
  <li>
    <h4 id="section-14">支持事务处理</h4>
  </li>
  <li>
    <h4 id="sql-dblistenfunctionsql-code-">支持数据库sql监听 <code class="highlighter-rouge">Db::listen(function($sql){ #code... })</code></h4>
  </li>
  <li>
    <h4 id="toarray-flip">支持数据集处理 toArray flip等</h4>
  </li>
  <li>
    <h4 id="section-15">支持数据库读写分离</h4>
  </li>
</ol>

<h3 id="section-16">五、缓存</h3>

<ol>
  <li>
    <h4 id="file--filememcacheredissqlitexcache">默认file驱动，支持自定义缓存驱动 支持多缓存 驱动默认支持:file、memcache、redis、sqlite、xcache</h4>
  </li>
  <li>
    <h4 id="cachesetnamevalue3600">写法：<code class="highlighter-rouge">Cache::set('name',$value,3600);</code></h4>
  </li>
  <li>
    <h4 id="routegetnewidnewsreadcache3600">支持针对路由的缓存 <code class="highlighter-rouge">Route::get('new/:id','News/read',['cache'=&gt;3600]);</code></h4>
  </li>
  <li>
    <h4 id="dbtablethinkuser-cachekey60-find">支持针对数据库查询的缓存<code class="highlighter-rouge">Db::table('think_user')-&gt;cache('key',60)-&gt;find();</code></h4>
  </li>
</ol>

<h3 id="section-17">六、异步</h3>

<ol>
  <li>
    <h4 id="topthinkthinkphp-queue-tp-redis---job-pushqueue-work">topthink/thinkphp-queue tp官方发布的扩展 默认支持redis队列 也支持 自定义驱动 先在业务逻辑层面将job push进queue 再启动work进程处理</h4>
  </li>
  <li><code class="highlighter-rouge">待看源码</code></li>
</ol>

<h3 id="section-18">七、部署</h3>

<ol>
  <li>
    <h4 id="openbasedirweb">确认open_basedir选项是否会影响web访问</h4>
  </li>
  <li>
    <h4 id="nginxpathinfo">检查低版本nginx对PATHINFO的支持</h4>
  </li>
  <li>
    <h4 id="think-migration">数据库迁移支持 think-migration</h4>
  </li>
</ol>

<h3 id="debug">八、debug</h3>

<ol>
  <li>
    <h4 id="section-19">通过环境变量或者配置项开启或者关闭调试模式</h4>
  </li>
  <li>
    <h4 id="sql--">记录SQL日志，模板无缓存 异常会显示请求信息 和错误代码位置</h4>
  </li>
  <li>
    <h4 id="trace-sql">trace调试 会显示加载时间、内存开销、SQL、流程、错误位置等</h4>
  </li>
  <li>
    <h4 id="debugremark-debuggetrangetimeremark">Debug::remark打点 Debug::getRangeTime取出remark区间执行时间</h4>
  </li>
  <li>
    <h4 id="dblistensql">Db::listen监听SQL</h4>
  </li>
  <li>
    <h4 id="socketchrome">支持远程socket远程调试，将错误日志发送到chrome显示</h4>
  </li>
</ol>

<h3 id="section-20">九、无用代码率</h3>
<p>…</p>

                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                                <h5 style="display: inline;">Tags:</h5>
                                
                                    <button class="btn btn-white btn-xs" type="button">php</button>
                                
                        </div>
                        <div class="col-md-6">
                            <div class="small text-right">
                                <h5>Stats:</h5>
                                <div> 
                                
                                    <i class="fa fa-comments-o"> </i> <span id = "url::/php/2017/05/23/ThinkPHP5.0.0%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90.html" class = "cy_cmt_count" ></span> comments
                                
                                
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- donate -->
                            
                            <br>
                            <!-- share -->
                            
                                <h2>Share:</h2>

<div class="bshare-custom">
	<a title="分享到微信" class="bshare-weixin"></a>
	<a title="分享到QQ空间" class="bshare-qzone"></a>
	<a title="分享到新浪微博" class="bshare-sinaminiblog"></a>
	<a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a>
</div>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=cdeed517-2e34-4287-8cb5-aef837206551&amp;pophcol=1&amp;lang=zh"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
                            
                            <br>
                            <!-- comment -->
                            
<h2>Comments:</h2>
<div id="SOHUCS"></div>
<script charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
    window.changyan.api.config({
        appid: 'cysEteUF0',
        conf: 'prod_b04efdcd652c29f9e4806ecb14edd799'
    });
</script>




                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>


	
	    <script src="/static/js/scroll.js"></script>

<!-- Baidu analytics -->


<!-- Google analytics -->





  <script id="cy_cmt_num" src="http://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cysfY7ULn"></script>


<script async src="/static/js/count_page.js"></script>

	

</body>
</html>